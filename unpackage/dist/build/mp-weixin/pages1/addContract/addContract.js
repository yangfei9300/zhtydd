(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages1/addContract/addContract"],{4872:function(t,e,o){},"4f07":function(t,e,o){"use strict";o.r(e);var i=o("7af9"),s=o.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(n);e["default"]=s.a},"6a4d":function(t,e,o){"use strict";o.r(e);var i=o("82d6"),s=o("4f07");for(var n in s)["default"].indexOf(n)<0&&function(t){o.d(e,t,(function(){return s[t]}))}(n);o("fbca");var a=o("828b"),h=Object(a["a"])(s["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=h.exports},"7af9":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{boothExh:{pageSize:"10",pageNum:"1",boothNo:"",exhId:""},serviceInput:{pageSize:"10",pageNum:"1",exhId:"",projectName:""},form:{qiyeName:"",contactsId:"",contactsName:"",contactsTel:"",contactsSign:"",yewuyuanSign:"",zhangId:"",yewuname:"",yewutel:"",kuan:[{index:0,planName:"",payAmount:"",planPercent:"100",planTime:""}]},boothList:[],selBotth:[],selService:[],selServiceDate:[],selBoothDate:[],alertBotth:!1,aleretService:!1,selqiye:null,lianxirenList:[],signType:1,zhangList:[],fuwuList:[],fuwuTypeList:[],money:0,payPlans:[{index:0,planName:"",payAmount:"",planPercent:"100",planTime:""}],hetongMobans:[],hetongMubanIndex:-1,userInfo:{}}},onLoad:function(){this.userInfo=t.getStorageSync("userInfo"),this.selqiye=t.getStorageSync("selqiye"),this.form.qiyeName=this.selqiye.params.exhibitorName,console.log("aa",this.form),this.getQiyeList(),this.getDianzizhang(),this.getuInfo(),this.staffservicelist(),this.servicecategorylist(),this.getFuwuSel(),this.getYudingBooth(),this.selHetongMuban()},onShow:function(){console.log("aaa",this.signType),1==this.signType?this.form.contactsSign=t.getStorageSync("img"):2==this.signType&&(this.form.yewuyuanSign=t.getStorageSync("img"))},methods:{toSubmit:function(){var e=this;if(!this.isSubmit())return!1;var o={exhId:t.getStorageSync("exhId"),contractName:"展商合同",exhibitorId:this.selqiye.exhibitorId,contactId:this.form.contactsId,customerName:this.form.qiyeName,customerAddress:this.selqiye.params.exhibitorAddress,customerPerson:this.form.contactsName,customerTel:this.form.contactsTel,customerFax:this.selqiye.exhibitorFax,registerCost:"0",totalRmb:this.money,afterDiscount:this.money,templateId:this.hetongMobans[this.hetongMubanIndex].id,params:{booths:this.selBoothDate,services:this.selServiceDate,payPlans:this.payPlans}};this.$axios.axios("POST",this.$paths.contractcreate,o).then((function(o){200==o.code?(e.$tools.showToast("合同提交完成"),t.showModal({title:"提示",content:"是否要生成合同文件",success:function(i){i.confirm?e.toNewHetong(o):i.cancel&&t.navigateBack({delta:1})}})):e.$tools.showToast(o.msg)})).catch((function(t){}))},isSubmit:function(){var t=this.selBoothDate,e=this.selServiceDate;if(t.length<=0&&e.length<=0)return this.$tools.showToast("展位或者服务任选一项才能提交"),!1;if(""==this.form.contactsId)return this.$tools.showToast("请选择企业联系人"),!1;var o=this.payPlans;if(o.length<=0)return this.$tools.showToast("至少添加一项打款计划"),!1;for(var i=!0,s=0;s<o.length;s++)""!=o[s].payAmount&&o[s].planTime&&""!=o[s].planTime||(i=!1);if(!i)return this.$tools.showToast("打款计划未完善"),!1;console.log("aaaa",o);var n=0;for(s=0;s<o.length;s++)n+=parseFloat(o[s].payAmount);return console.log("--",n,this.money),n!=this.money?(this.$tools.showToast("计划打款总金额不对"),!1):!(this.hetongMubanIndex<0)||(this.$tools.showToast("请选择合同模版"),!1)},toNewHetong:function(e){var o=this,i={id:e.contractId+""};this.$axios.axios("post",this.$paths.staffcontractgenerate,i).then((function(e){200==e.code?(o.$tools.showToast("文件生成成功"),t.redirectTo({url:"/pages2/yewuyuanQianzi/yewuyuanQianzi?id="+i.id})):o.$tools.showToast(e.msg)})).catch((function(t){}))},hetongMubanIndexClick:function(t){this.hetongMubanIndex=t},selHetongMuban:function(){var e=this,o={exhId:t.getStorageSync("exhId"),pageNum:"1",pageSize:"1000"};this.$axios.axios("get",this.$paths.contracttemplatelist,o).then((function(t){200==t.code?e.hetongMobans=t.rows:e.$tools.showToast(t.msg)})).catch((function(t){}))},toTuidingfuwu:function(t){var e=this,o={ids:t.id};this.$axios.axios("POST",this.$paths.staffservicedel+t.id,o).then((function(t){200==t.code?(e.$tools.showToast("退订成功"),setTimeout((function(t){e.getFuwuSel()}),1e3)):e.$tools.showToast(t.msg)})).catch((function(t){}))},delBooths:function(e){var o=this,i=t.getStorageSync("selqiye"),s={exhId:t.getStorageSync("exhId"),exhibitorId:i.exhibitorId,params:{booths:e.id}};this.$axios.axios("POST",this.$paths.boothreturnbooth,s).then((function(t){200==t.code?(o.$tools.showToast("退订成功"),setTimeout((function(t){o.getYudingBooth()}),1e3)):o.$tools.showToast(t.msg)})).catch((function(t){}))},getYudingBooth:function(){var e=this,o=t.getStorageSync("selqiye"),i={pageSize:"300",pageNum:"1",exhId:t.getStorageSync("exhId"),exhibitorId:o.exhibitorId};this.$axios.axios("GET",this.$paths.boothlistbuy,i).then((function(t){if(200==t.code){console.log("展位列表选择",t),e.selBoothDate=t.rows;for(var o=[],i=t.rows,s=0;s<i.length;s++)"0"==i[s].params.outStatus&&o.push(i[s]);e.selBoothDate=o,e.numAllMoney()}else e.$tools.showToast(t.msg)})).catch((function(t){}))},getFuwuSel:function(){var e=this,o=t.getStorageSync("selqiye"),i={pageSize:"300",pageNum:"1",exhId:t.getStorageSync("exhId"),exhibitorId:o.exhibitorId};this.$axios.axios("GET",this.$paths.servicelistbook,i).then((function(t){200==t.code?(console.log("服务选择",t),e.selServiceDate=t.rows,e.numAllMoney()):e.$tools.showToast(t.msg)})).catch((function(t){}))},yudingfuwu:function(e){var o=this,i=(this.selService,[]),s=t.getStorageSync("selqiye"),n=t.getStorageSync("exhId"),a=t.getStorageSync("userInfo"),h={exhibitorId:s.exhibitorId,serviceId:e.id,reservationNum:1,exhId:n,userId:a.userId};i.push(h),this.$axios.axios("POST",this.$paths.servicebuy,i).then((function(t){200==t.code?(o.$tools.showToast("预定成功"),setTimeout((function(t){o.getFuwuSel()}),1e3)):o.$tools.showToast(t.msg)})).catch((function(t){}))},yudingBooth:function(e){var o=this,i=(this.selBotth,[]);i.push(e.id);var s=t.getStorageSync("selqiye"),n={id:s.id,exhibitorId:s.exhibitorId,params:{booths:i.join(",")}};this.$axios.axios("POST",this.$paths.boothbuybooth,n).then((function(t){200==t.code?(o.$tools.showToast("预定成功"),setTimeout((function(t){o.getYudingBooth()}),1e3)):o.$tools.showToast(t.msg)})).catch((function(t){}))},numAllMoney:function(){for(var t=this.selBoothDate,e=this.selServiceDate,o=0,i=0;i<t.length;i++)o+=t[i].rmbPrice;for(i=0;i<e.length;i++)o+=e[i].params.rmbPrice;o=o.toFixed(2),this.money=o},delService:function(t){this.selService.splice(t,1)},aleretServiceClick:function(){this.aleretService=!this.aleretService},selServiceAdd:function(t){for(var e=this.selService,o=!1,i=0;i<e.length;i++)t.id==e[i].id&&(o=!0);if(o)return this.$tools.showToast("请勿重复添加"),!1;e.push(t),this.selService=e,console.log("==",this.selService),this.yudingfuwu(t),this.numAllMoney()},staffservicelist:function(){var e=this;if(""==this.serviceInput.projectName)return this.$tools.showToast("请输入搜索内容"),!1;var o={pageSize:"300",pageNum:"1",exhId:t.getStorageSync("exhId"),projectName:this.serviceInput.projectName};this.$axios.axios("GET",this.$paths.staffservicelist,o).then((function(t){200==t.code?e.fuwuList=t.rows:e.$tools.showToast(t.msg)})).catch((function(t){}))},servicecategorylist:function(){var e=this,o={pageSize:"300",pageNum:"1",exhId:t.getStorageSync("exhId")};this.$axios.axios("GET",this.$paths.servicecategorylist,o).then((function(t){200==t.code?e.fuwuTypeList=t.data:e.$tools.showToast(t.msg)})).catch((function(t){}))},changeDateKuan:function(t,e){this.payPlans[e].planTime=t.detail.value},addKuan:function(){this.payPlans.push({index:0,planName:"",payAmount:"",planPercent:"100",planTime:""})},getuInfo:function(){var e=t.getStorageSync("userInfo");e&&(this.form.yewuname=e.nickName,this.form.yewutel=e.phonenumber)},selZhangClick:function(t){this.form.zhangId=t},getDianzizhang:function(){var t=this,e={pageSize:"300",pageNum:"1",exhibitorId:this.selqiye.exhibitorId};this.$axios.axios("GET",this.$paths.seallist,e).then((function(e){200==e.code?(t.zhangList=e.rows,t.zhangList.length>0&&(t.form.zhangId=t.zhangList[a].id)):t.$tools.showToast(e.msg)})).catch((function(t){}))},lianxirenChange:function(t){this.form.contactsId=this.lianxirenList[parseInt(t.detail.value)].id,this.form.contactsName=this.lianxirenList[parseInt(t.detail.value)].contactName,this.form.contactsTel=this.lianxirenList[parseInt(t.detail.value)].contactPhone},getQiyeList:function(){var t=this,e={pageSize:"300",pageNum:"1",exhibitorId:this.selqiye.exhibitorId};this.$axios.axios("GET",this.$paths.exhibitorcontactlist,e).then((function(e){200==e.code?t.lianxirenList=e.rows:t.$tools.showToast(e.msg)})).catch((function(t){}))},delboothSel:function(t){this.selBotth.splice(t,1)},alertBotthClick:function(){this.alertBotth=!this.alertBotth},addSelbotth:function(t){for(var e=this.selBotth,o=!1,i=0;i<e.length;i++)e[i].boothNo==t.boothNo&&(o=!0);if(o)return this.$tools.showToast("请勿重复添加"),!1;e.push(t),this.selBotth=e},getZhanwei:function(){var e=this,o=this.boothExh;if(""==o.boothNo)return this.$tools.showToast("展位号不能为空"),!1;o.exhId=t.getStorageSync("exhId"),this.$axios.axios("GET",this.$paths.boothlistnotbuy,o).then((function(t){200==t.code?e.boothList=t.rows:e.$tools.showToast(t.msg)})).catch((function(t){}))},toSign:function(e){this.signType=e,t.navigateTo({url:"/pages1/signView/signView"})}}};e.default=o}).call(this,o("df3c")["default"])},"82d6":function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){}));var i=function(){var t=this.$createElement;this._self._c},s=[]},e047:function(t,e,o){"use strict";(function(t,e){var i=o("47a9");o("47a5");i(o("3240"));var s=i(o("6a4d"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(s.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},fbca:function(t,e,o){"use strict";var i=o("4872"),s=o.n(i);s.a}},[["e047","common/runtime","common/vendor"]]]);